<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../../bower_components/brum-global-variable/brum-global-variable.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="elith-client-form.html">
<link rel="import" href="../elith-icons.html">
<link rel="import" href="../elith-error.html">
<link rel="import" href="../elith-iron-ajax.html">
<link rel="import" href="../styles/elith-styles.html">



<dom-module id="elith-client-add">
    <template>
        <style include="elith-styles">
            :host {
                display: block;
                padding: 20px;
            }
        </style>

        <iron-localstorage name="user-storage" value="{{storedUser}}"></iron-localstorage>
        <brum-global-variable key="userData" value="{{storedUser}}"></brum-global-variable>
        <app-location route="{{route}}"></app-location>

        <!------------------------------------------------------------------------------------------------>
        <!------------------------------------------------------------------------------------------------>
            <div class="container">
                <div class="clientNameHeader">
                    <h1>Cr√©ation du dossier</h1>
                </div>

                <elith-iron-ajax id="1" element="[[client]]" module="client" methode="post" response="{{client}}" hidden$="[[isInvalide]]" path="{{route.path}}"></elith-iron-ajax>
                <paper-icon-button class="bubble1" icon="elith-icons:put"  hidden$="[[!isInvalide]]" disabled="[[isInvalide]]"></paper-icon-button>
                <paper-icon-button class="bubble2" on-tap="_cancel" icon="elith-icons:cancel"></paper-icon-button>


            <iron-form id="ajoutClient">
                <form is="iron-form" id="addClient" method="post">
                    <elith-client-form client="{{client}}" edition="{{modeEdition}}" invalide="{{isInvalide}}"></elith-client-form>
                </form>
            </iron-form>

            </div>


    </template>

    <script>
      class ElithClientadd extends Polymer.Element {
        static get is () {
          return 'elith-client-add'
        }

        static get properties () {
          return {
            route: {
              path: {
                type: Object,
                observer: '_pathChanged',
              }
            },
            client: {
              type : Object,
              observer: '_clientChanged',
            },
            modeEdition: {
              type : Object,
              value: true,
              notify : true,
            },
            isInvalide: {
              type : Object,
              notify : true,
            },
            added: {
              type : Object,
              notify : true,
              value: false,
            },
          }
        }


        _clientChanged(){
          if(this.client !== null && typeof(this.client.items) !== 'undefined'){
            this.added = true ;
          }
        }

        _pathChanged(path){
          if(path !== null && typeof(path) !== 'undefined'){
            this.set('route.path', path);
          }
        }

        _cancel(e) {
          this.client = {};
        }

      }

      window.customElements.define(ElithClientadd.is, ElithClientadd)
    </script>
</dom-module>
