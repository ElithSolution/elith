<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/vaadin-form-layout/vaadin-form-layout.html">
<link rel="import" href="../styles/elith-styles.html">
<link rel="import" href="../elith-icons.html">



<dom-module id="elith-client-form">
    <template>
        <style include="elith-styles">
            :host {
                display: block;
                padding-top: 10px;
                padding-bottom: 10px;
            }
        </style>


        <div class="divContainer" >
            <fieldset id="1" hidden$="[[_cacherSection(section, '1')]]">
                <div>
                    <vaadin-form-layout>
                        <paper-input label="Nom" value="{{client.nom}}" disabled$="[[!edition]]" auto-validate invalid="{{nomInvalide}}" required ></paper-input>
                        <paper-input label="Prénom" value="{{client.prenom}}" disabled$="[[!edition]]" auto-validate invalid="{{prenomInvalide}}" required></paper-input>
                        <paper-input label="Naissance" value="{{client.dateNaissanceString}}" disabled$="[[!edition]]" auto-validate invalid="{{dateInvalide}}" required
                                     pattern="^(0?[1-9]|[12][0-9]|3[01])[\-](0?[1-9]|1[012])[\-](19|20)\d{2}$" error-message="Utiliser le format jj-mm-aaaa"></paper-input>
                        <paper-input label="Enfant(s)" value="{{client.enfants}}" disabled$="[[!edition]]" auto-validate invalid="{{enfantInvalide}}"
                                     pattern="[0-9]*" error-message="Veuillez saisir un chiffre"></paper-input>
                        <paper-textarea label="Adresse" value="{{client.adresse}}" disabled$="[[!edition]]"></paper-textarea>
                        <paper-input label="Ville" value="{{client.ville}}" disabled$="[[!edition]]"></paper-input>
                        <paper-input label="Téléphone" value="{{client.telephone}}" disabled$="[[!edition]]"></paper-input>
                        <paper-input label="Courriel" value="{{client.email}}" disabled$="[[!edition]]" auto-validate invalid="{{emailInvalide}}" type="email"></paper-input>
                        <paper-input label="Emploi" value="{{client.emploi}}" disabled$="[[!edition]]"></paper-input>
                        <paper-input label="Loisirs" value="{{client.loisirs}}" disabled$="[[!edition]]"></paper-input>
                    </vaadin-form-layout>
                </div>
            </fieldset>

            <fieldset id="2" hidden$="[[_cacherSection(section, '2')]]">
                <div>
                <vaadin-form-layout>
                    <paper-textarea label="Autres thérapies" value="{{client.autresTherapies}}" disabled$="[[!edition]]"></paper-textarea>
                    <paper-textarea label="Médicaments" value="{{client.medicaments}}" disabled$="[[!edition]]"></paper-textarea>
                    <paper-textarea label="Compléments" value="{{client.complements}}" disabled$="[[!edition]]"></paper-textarea>
                    <paper-textarea label="Constipation" value="{{client.constipation}}" disabled$="[[!edition]]"></paper-textarea>
                    <paper-textarea label="Allergies" value="{{client.allergies}}" disabled$="[[!edition]]"></paper-textarea>
                    <paper-textarea label="Opérations" value="{{client.histoOperations}}" disabled$="[[!edition]]"></paper-textarea>
                    <paper-textarea label="Autre" value="{{client.autre}}" disabled$="[[!edition]]"></paper-textarea>
                    <br>
                    <paper-toggle-button checked="{{client.cardiaque}}" disabled="[[!edition]]">Cardiaque</paper-toggle-button>
                    <paper-toggle-button checked="{{client.asthme}}" disabled="[[!edition]]">Asthme</paper-toggle-button>
                    <paper-toggle-button checked="{{client.hypoglycemie}}" disabled="[[!edition]]">Hypoglycémie</paper-toggle-button>
                    <paper-toggle-button checked="{{client.diabete}}" disabled="[[!edition]]">Diabète</paper-toggle-button>
                    <paper-toggle-button checked="{{client.peau}}" disabled="[[!edition]]">Problème de peau</paper-toggle-button>
                    <paper-toggle-button checked="{{client.fumeur}}" disabled="[[!edition]]">Fumeur</paper-toggle-button>
                    <paper-toggle-button checked="{{client.osteoporose}}" disabled="[[!edition]]">Ostéporose</paper-toggle-button>
                    <paper-toggle-button checked="{{client.arthrose}}" disabled="[[!edition]]">Arthrose</paper-toggle-button>
                </vaadin-form-layout>
                </div>
            </fieldset>

        <fieldset id="3" hidden$="[[_cacherSection(section, '3')]]">
            <div>
                <vaadin-form-layout>
                    <paper-input label="Référé par" value="{{client.refere}}" disabled$="[[!edition]]"></paper-input>
                    <paper-textarea label="Historique de la douleur" value="{{client.histoDouleur}}" disabled$="[[!edition]]"></paper-textarea>
                    <paper-textarea label="Constatations" value="{{client.constatations}}" disabled$="[[!edition]]"></paper-textarea>
                    <paper-textarea label="Attention" value="{{client.attentions}}" disabled$="[[!edition]]"></paper-textarea>
                    <paper-textarea label="À ne pas masser" value="{{client.pasMasser}}" disabled$="[[!edition]]"></paper-textarea>
                    <paper-textarea label="Note" value="{{client.note}}" disabled$="[[!edition]]"></paper-textarea>

                </vaadin-form-layout>
            </div>
        </fieldset>

            <dom-if if="{{hasIdClient}}">
                <template>
                     <fieldset id="4" hidden$="[[_cacherSection(section, '4')]]">
                    <!------------------------------------------------------------------------------------------------>
                    <!--------------------        Affichage des traitements de la personne        -------------------->
                    <!------------------------------------------------------------------------------------------------>
                    <elith-client-traitements traitements="{{traitements}}" idclient="[[client.id]]"></elith-client-traitements>
                    </fieldset>
                </template>
            </dom-if>

        </div>

</template>

    <script>
      class ElithClientform extends Polymer.Element {
        static get is () {
          return 'elith-client-form'
        }

        static get properties () {
          return {
            client: {
              type : Object,
              observer: '_clientChanged',
            },
            edition: Object,
            nomInvalide: {
              value : true,
              observer: 'invalideChanged'
            },
            prenomInvalide: {
              value : true,
              observer: 'invalideChanged'
            },
            enfantInvalide: {
              observer: 'invalideChanged'
            },
            dateInvalide: {
              value : true,
              observer: 'invalideChanged'
            },
            emailInvalide: {
              observer: 'invalideChanged'
            },
            invalide :{
              notify : true,
            },
            section : Object,
            traitements : Object,
            hasIdClient: {
              type : Boolean,
              value : false,
            },
          }
        }


        _cacherSection(section, id){
          let res = true ;
          switch (section) {
            case 'RENSEIGNEMENTS':
              if (id == '1') res = false; break ;
            case 'INFO' :
              if (id == '2') res = false; break ;
            case 'NOTES' :
              if (id == '3') res = false; break ;
            case 'TRAITEMENTS' :
              if (id == '4') res = false; break ;
            default :
              res = true;
          }
          return res ;
        }

        invalideChanged(){
           this.invalide = this.nomInvalide || this.prenomInvalide || this.enfantInvalide || this.dateInvalide || this.emailInvalide;
        }

        _clientChanged(){
          this.hasIdClient = false ;
          if(this.client != null && typeof(this.client) !== 'undefined'){
            if(typeof(this.client.id) !== 'undefined'){
              this.hasIdClient = true ;
            }
          }
        }

      }




      window.customElements.define(ElithClientform.is, ElithClientform)
    </script>
</dom-module>
